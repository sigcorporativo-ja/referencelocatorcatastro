!function(e){var t={};function a(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(s,n,function(t){return e[t]}.bind(null,n));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=5)}([function(e,t){e.exports='<div id="referencelocatorcatastro-id" class="m-control m-container m-referencelocatorcatastro-container">\n    <div class="header">\n        \x3c!-- TITLE --\x3e\n        \x3c!--<div class="titleBusquedaCatastral">Búsqueda catastral</div>--\x3e\n        <button id="m-referencelocatorcatastro-button" class="icon-navigation-busqueda-catastral" title="Búsqueda catastral"></button>\n        <button id="m-catastrogetinfo-button" class="g-cartografia-catastrogetinfo-button" title="Consultar datos catastrales"></button>\n        <button id="m-catastroclear-button" class="g-cartografia-papelera" title="Limpiar resultados"></button>\n    </div>\n    <div class="m-tabs-referencelocatorcatastro-container">\n        <ul id="m-tabs-referencelocatorcatastro" class="group">\n            <li><a class="activated">Referencia Catastral</a></li>\n            <li><a>Búsqueda por polígono y parcela</a></li>\n        </ul>\n        <div id="m-tabs-referencelocatorcatastro-content">\n            \x3c!-- Parámetros de búsqueda --\x3e\n            <div id="m-searchRC-container" class="m-searchRC-tab m-tabcontent-referencelocatorcatastro show">\n                <input type="text" id="m-searchRC-input" class="g-cartografia-searchRC-input" maxlength="20" placeholder="Introduzca los 14 ó 20 dígitos de la RC"></input>\n                <div id="button-rc" class="button">\n                    <button id="m-searchRC-button" class="search" title="Buscar">\n                        <i class="g-cartografia-zoom m-search-btn"></i>Buscar\n                    </button>\n                    <button id="m-clearRC-button" class="search" title="Limpiar Resultados">\n                        <i class="g-cartografia-papelera m-search-btn"></i>Limpiar\n                    </button>\n                </div>\n            </div>\n            <div id="m-searchParams-container" class="m-searchParams-tab m-tabcontent-referencelocatorcatastro">\n                <label id="m-searchParamsProvincia-label" class="g-cartografia-searchParamsProvincia-label">Provincia:</label>\n                <select id="m-searchParamsProvincia-select" name="Provincias" class="g-cartografia-searchParamsProvincia-select">\n                    <option value="0">Seleccione una provincia</option>\n                    <option value="04">ALMERÍA</option>\n                    <option value="11">CÁDIZ</option>\n                    <option value="14">CÓRDOBA</option>\n                    <option value="18">GRANADA</option>\n                    <option value="21">HUELVA</option>\n                    <option value="23">JAÉN</option>\n                    <option value="29">MÁLAGA</option>\n                    <option value="41">SEVILLA</option>\n                </select>\n                <br>\n                <label id="m-searchParamsMunicipio-label" class="g-cartografia-searchParamsMunicipio-label">Municipio:</label>\n                <select id="m-searchParamsMunicipio-select" name="Municipios" class="g-cartografia-searchParamsMunicipio-select">\n                    <option value="0">Seleccione un municipio</option>\n                </select>\n                <br>\n                <label id="m-searchParamsPoligono-label" class="g-cartografia-searchParamsPoligono-label">Polígono:</label>\n                <input type="text" id="m-searchParamsPoligono-input" class="g-cartografia-searchParamsPoligono-input" placeholder="Introduzca un polígono">\n                <br>\n                <label id="m-searchParamsParcela-label" class="g-cartografia-searchParamsParcela-label">Parcela:</label> <input type="text" id="m-searchParamsParcela-input" class="g-cartografia-searchParamsParcela-input" placeholder="Introduzca una parcela">\n                <div id="button-params" class="button">\n                    <button id="m-searchParams-button" class="search" title="Buscar">\n                        <i class="g-cartografia-zoom m-search-btn"></i>Buscar\n                    </button>\n\n                    <button id="m-clearParams-button" class="search" title="Limpiar Resultados">\n                        <i class="g-cartografia-papelera m-search-btn"></i>Limpiar\n                    </button>\n                </div>\n            </div>\n        </div>\n        \x3c!-- Resultados de búsqueda --\x3e\n        <div id=m-referencelocatorcatastro-results>\n            \x3c!-- results searchRC --\x3e\n            <div id="m-searchRC-results" class="m-searchRC m-tabcontent-referencelocatorcatastro results-panel show">\n                <div id="m-searching-result-searchRC" class="m-searching-result g-cartografia-spinner"></div>\n            </div>\n            \x3c!-- results searchParams --\x3e\n            <div id="m-searchParams-results" class="m-searchParams m-tabcontent-referencelocatorcatastro results-panel">\n                <div id="m-searching-result-searchParams" class="m-searching-result g-cartografia-spinner"></div>\n            </div>\n        </div>\n    </div>\n</div>'},function(e,t){e.exports='<div class="catastro-results-panels">\n    {{#if partial}}\n        <div class="partial">\n            <p>No se han encontrado resultados para la búsqueda.</p>\n        </div>\n    {{/if}}\n    <div class="results" id="m-catastro-results-scroll">\n        {{#each docs}}\n            <div id="{{rcId}}" class="result">\n                {{#each attributes}}\n                    <table>\n                        <tbody>\n                            <tr>\n                                <td class="key">{{key}}</td>\n                                <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n                            </tr>\n                        </tbody>\n                    </table>\n                {{/each}}\n            </div>\n        {{/each}}\n    </div>\n    {{#eq docs.length 0}}\n        <div class="results">\n            <div class="partial">No se han encontrado resultados para la búsqueda "{{query}}".</div>\n        </div>\n    {{/eq}}\n    <div class="page" id="currentPage">\n        <span class="found" id="m-catastro-page-found">{{docs.length}}</span> de <span class="total">{{total}}</span>\n    </div>\n</div>'},function(e,t){e.exports='<div class="m-catastrogetinfo-content">\n    {{#each features}}\n        <div class="result">\n            {{#each attributes}}\n                <table>\n                    <tr>\n                        <td class="key"><b>{{key}}</b></td>\n                        <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n                    </tr>\n                </table>\n            {{/each}}\n        </div>\n        <div class="m-separator"></div>\n    {{/each}}\n</div>'},function(e){e.exports=JSON.parse('{"url":{"name":"referenceLocatorCatastro","separator":"*"},"constructor":"M.plugin.ReferenceLocatorCatastro","parameters":[{"type":"object","properties":[{"type":"simple","name":"RCCOOR_url","value":"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCoordenadas.asmx/Consulta_RCCOOR","position":0},{"type":"simple","name":"CMC_url","value":"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCallejeroCodigos.asmx/ConsultaMunicipioCodigos","position":1},{"type":"simple","name":"DNPRC_url","value":"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCallejeroCodigos.asmx/Consulta_DNPRC_Codigos","position":2},{"type":"simple","name":"CPMRC_url","value":"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCoordenadas.asmx/Consulta_CPMRC","position":3},{"type":"simple","name":"DNPPP_url","value":"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCallejeroCodigos.asmx/Consulta_DNPPP_Codigos","position":4},{"type":"object","name":"catastroWMS","position":5,"properties":[{"type":"simple","name":"wms_url","value":"https://ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx?"},{"type":"simple","name":"name","value":"Catastro"}]}]}],"files":{"ol":{"scripts":["referencelocatorcatastro.ol.min.js"],"styles":["referencelocatorcatastro.ol.min.css"]}},"metadata":{"name":"ReferenceLocatorCatastro","description":"Búsqueda catastral","text":"Búsqueda catastral mediante referencia catastral o polígono y parcela","version":"1.1.0","date":"Junio, 2020","author":"","org":"Consejería de Medioambiente y Ordenación del Territorio de la Junta de Andalucía","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","centralized":true}}')},function(e,t,a){},function(e,t,a){"use strict";a.r(t);a(4);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function r(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e,t,a){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var s=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(s){var n=Object.getOwnPropertyDescriptor(s,t);return n.get?n.get.call(a):n.value}})(e,t,a||e)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,i(t).apply(this,arguments))}var a,s,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,M.impl.Control),a=t,(s=[{key:"addTo",value:function(e,a){o(i(t.prototype),"addTo",this).call(this,e,a)}}])&&n(a.prototype,s),c&&n(a,c),t}(),u=a(0),d=a.n(u),m=a(1),p=a.n(m),h=a(2),v=a.n(h);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function y(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(c)&&M.exception("La implementación usada no puede crear controles ReferenceLocatorCatastroControl.");var s=new c;return a=y(this,_(t).call(this,s,"ReferenceLocatorCatastro")),e?(a.options=e||{},a.config_=e||{}):M.exception("ReferenceLocatorCatastroControl: configuración no válida."),(M.utils.isUndefined(a.options.name)||M.utils.isNullOrEmpty(a.options.name))&&(a.options.name=a.NAME||"ReferenceLocatorCatastro"),a.facadeMap_=null,a.inputRC_=null,a.selectProvincias=null,a.selectMunicipios=null,a.inputPoligono=null,a.inputParcela=null,a.ConsultaMunicipioCodigos_=a.config_.CMC_url,a.DNPRC_url_=a.config_.DNPRC_url,a.CPMRC_url_=a.config_.CPMRC_url,a.DNPPP_url_=a.config_.DNPPP_url,a.RCCOOR_url_=a.config_.RCCOOR_url,a.resultsRCContainer_=null,a.resultsParamsContainer_=null,a.resultsScrollContainer_=null,a.searchingRCResult_=null,a.searchingParamsResult_=null,a.searchTime_=0,a.rcResults_=[],a.paramsResults_=[],a.scrollIsUp_=!0,a.draggablePanel=null,a.panelMinimized=!1,a.element_=null,a.SEARCHING_CLASS="m-searching",a.HIDDEN_RESULTS_CLASS="hidden",a.POPUP_TITLE="Información catastral",a.layer_=new M.layer.GeoJSON({name:"Localizador Catastral",crs:"25830"}),a}var a,s,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,M.Control),a=t,(s=[{key:"addEvents_",value:function(e){this.element_=e,this.resultsRCContainer_=this.element_.querySelector("div#m-searchRC-results"),this.searchingRCResult_=this.element_.querySelector("div#m-searchRC-results > div#m-searching-result-searchRC"),this.resultsParamsContainer_=this.element_.querySelector("div#m-searchParams-results"),this.searchingParamsResult_=this.element_.querySelector("div#m-searchParams-results > div#m-searching-result-searchParams")}},{key:"createView",value:function(e){var t=this;return this.facadeMap_=e,this.facadeMap_.addLayers(this.layer_),this.layer_.displayInLayerSwitcher=!1,new Promise(function(e,a){var s=M.template.compileSync(d.a);t.setStyle(s,t.options),t.element_=s,t.createCatastroPanel(),t.addEvents_(t.element_),t.togglePanel(),e(s)})}},{key:"createCatastroPanel",value:function(){var e=this,t=this.element_.querySelector("div#m-searchRC-container"),a=this.element_.querySelector("div#m-searchParams-container"),s=this.element_.querySelector("div#m-searchRC-results"),n=this.element_.querySelector("div#m-searchParams-results"),r=this.element_.querySelector("ul#m-tabs-referencelocatorcatastro > li:nth-child(1) > a"),o=this.element_.querySelector("ul#m-tabs-referencelocatorcatastro > li:nth-child(2) > a");r.addEventListener("click",function(){r.classList.contains("activated")||(r.classList.add("activated"),o.classList.remove("activated"),t.classList.add("show"),s.classList.add("show"),n.classList.remove("show"),a.classList.remove("show"))}),o.addEventListener("click",function(){o.classList.contains("activated")||(o.classList.add("activated"),r.classList.remove("activated"),t.classList.remove("show"),s.classList.remove("show"),n.classList.add("show"),a.classList.add("show"))}),this.inputRC_=this.element_.querySelector("#m-searchRC-input"),this.inputRC_.addEventListener("keyup",this.onRCSearch.bind(this)),this.element_.querySelector("#m-referencelocatorcatastro-button").addEventListener("click",this.activeSearch.bind(this)),this.element_.querySelector("#m-catastrogetinfo-button").addEventListener("click",this.activeInfo.bind(this)),this.element_.querySelector("#m-catastroclear-button").addEventListener("click",this.clearResults.bind(this)),this.selectProvincias=this.element_.querySelector("#m-searchParamsProvincia-select"),this.selectProvincias.addEventListener("change",this.onProvinciaSelect.bind(this)),this.selectMunicipios=this.element_.querySelector("#m-searchParamsMunicipio-select"),this.inputPoligono=this.element_.querySelector("#m-searchParamsPoligono-input"),this.inputParcela=this.element_.querySelector("#m-searchParamsParcela-input"),this.element_.querySelector("#m-searchRC-button").addEventListener("click",this.onRCSearch.bind(this)),this.element_.querySelector("#m-searchParams-button").addEventListener("click",function(t){return e.onParamsSearch(t)}),this.element_.querySelector("#m-clearRC-button").addEventListener("click",this.clearResults.bind(this)),this.element_.querySelector("#m-clearParams-button").addEventListener("click",this.clearResults.bind(this))}},{key:"setStyle",value:function(e,t){M.utils.isUndefined(t.tooltip)||M.utils.isNullOrEmpty(t.tooltip)||e.querySelector("button").setAttribute("title",t.tooltip),M.utils.isUndefined(t.icon)||M.utils.isNullOrEmpty(t.icon)||e.querySelector("button").setAttribute("class",t.icon),M.utils.isUndefined(t.order)||M.utils.isNullOrEmpty(t.order)||e.querySelector("button").parentNode.setAttribute("style","order: ".concat(t.order))}},{key:"activeSearch",value:function(){this.deactivate(),this.togglePanel();var e=this.element_.querySelector("#m-referencelocatorcatastro-button").classList;e.contains("activated")?e.remove("activated"):e.add("activated")}},{key:"activeInfo",value:function(){!1===this.panelMinimized&&this.togglePanel(),this.activate()}},{key:"addClearEvents",value:function(e){this.on(M.evt.COMPLETED,function(){e.classList.add("shown")}),e.querySelector("#m-clearRC-button").addEventListener("click",this.clearResults.bind(this)),e.querySelector("#m-clearParams-button").addEventListener("click",this.clearResults.bind(this)),e.querySelector("#dialog-close-catastro").addEventListener("click",this.clearResults.bind(this))}},{key:"clearResults",value:function(){this.clearClick_()}},{key:"buildUrl_",value:function(e){var t=this,a=this.facadeMap_.getProjection().code;M.remote.get(this.RCCOOR_url_,{SRS:a,Coordenada_X:e.coord[0],Coordenada_Y:e.coord[1]}).then(function(a){t.showInfoFromURL_(a,e.coord)},{jsonp:!0})}},{key:"showInfoFromURL_",value:function(e,t){var a=this;if(200===e.code&&!1===e.error){var s=[],n=e.text,r=this.formatInfo_(n);s.push(r);var o={icon:"g-cartografia-pin",title:this.POPUP_TITLE,content:s.join("")},i=this.facadeMap_.getPopup();if(M.utils.isNullOrEmpty(i))(i=new M.Popup).addTab(o),this.facadeMap_.addPopup(i,t);else if(i.getCoordinate()[0]===t[0]&&i.getCoordinate()[1]===t[1]){var l=!1;i.getTabs().forEach(function(e){e.title!==a.POPUP_TITLE?l=!0:i.removeTab(e)}),l?i.addTab(o):((i=new M.Popup).addTab(o),this.facadeMap_.addPopup(i,t))}else(i=new M.Popup).addTab(o),this.facadeMap_.addPopup(i,t)}else this.facadeMap_.removePopup(),M.dialog.error("MAPEA: No es posible establecer la conexión con el servidor de Catastro.")}},{key:"formatInfo_",value:function(e){var t,a,s,n,r=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("consulta_coordenadas")[0];if("1"===r.getElementsByTagName("control")[0].getElementsByTagName("cuerr")[0].childNodes[0].nodeValue){a=r.getElementsByTagName("lerr")[0].getElementsByTagName("err")[0].getElementsByTagName("des")[0].childNodes[0].nodeValue}else{var o=r.getElementsByTagName("coordenadas")[0].getElementsByTagName("coord")[0],i=o.getElementsByTagName("pc")[0].getElementsByTagName("pc1")[0].childNodes[0].nodeValue,l=o.getElementsByTagName("pc2")[0].childNodes[0].nodeValue;s=i.substring(0,2),n=i.substring(2,5),t=o.getElementsByTagName("ldt")[0].childNodes[0].nodeValue,a=i+l}var c="https://www1.sedecatastro.gob.es/CYCBienInmueble/OVCConCiud.aspx?UrbRus=&RefC=".concat(a,"&esBice=&RCBice1=&RCBice2=&DenoBice=&from=OVCBusqueda&pest=rc&RCCompleta=").concat(a,"&final=&del=").concat(s,"&mun=").concat(n);return"".concat(M.utils.beautifyAttribute("Información Catastral"),"\n    <div class='divinfo'>\n    <table class='mapea-table'>\n    <tbody>\n    <tr><td class='header' colspan='4'></td></tr>\n    <tr><td class='key'><b>").concat(M.utils.beautifyAttribute("Referencia catastral"),"</b></td><td class='value'></b>\n    <a href='").concat(c,"' target='_blank'>").concat(a,"</a></td></tr>\n    <tr><td class='key'><b>").concat(M.utils.beautifyAttribute("Descripción"),"</b></td>\n    <td class='value'>").concat(t,"</td></tr>\n    </tbody></table></div>")}},{key:"togglePanel",value:function(){var e=this.element_.querySelector(".m-tabs-referencelocatorcatastro-container");!1===this.panelMinimized?(this.panelMinimized=!0,e.style.display="none"):(this.panelMinimized=!1,e.style.display="inline")}},{key:"onRCSearch",value:function(e){if(e.preventDefault(),"keyup"!==e.type||13===e.keyCode){var t=this.inputRC_&&this.inputRC_.value;if(M.utils.isNullOrEmpty(t))M.dialog.info("Debe introducir una referencia catastral");else{t=t.substr(0,14);var a=M.utils.addParameters(this.CPMRC_url_,{Provincia:"",Municipio:"",SRS:this.facadeMap_.getProjection().code,RC:t});this.search_(a,this.resultsRCContainer_,this.searchingRCResult_,this.showResults_)}}}},{key:"onParamsSearch",value:function(e){if(e.preventDefault(),"keyup"!==e.type||13===e.keyCode){if(M.utils.isNullOrEmpty(this.selectProvincias.value)||"0"===this.selectProvincias.value)return void M.dialog.info("Debe seleccionar una provincia.");if(M.utils.isNullOrEmpty(this.selectMunicipios.value)||"0"===this.selectMunicipios.value)return void M.dialog.info("Debe seleccionar un municpio.");if(M.utils.isNullOrEmpty(this.inputPoligono.value))return void M.dialog.info("Debe introducir un polígono.");if(M.utils.isNullOrEmpty(this.inputParcela.value))return void M.dialog.info("Debe introducir una parcela.");var t=M.utils.addParameters(this.DNPPP_url_,{CodigoProvincia:this.selectProvincias.value,CodigoMunicipio:this.selectMunicipios.value,CodigoMunicipioINE:"",Poligono:this.inputPoligono.value,Parcela:this.inputParcela.value});this.search_(t,this.resultsParamsContainer_,this.searchingParamsResult_,this.showResults_)}}},{key:"search_",value:function(e,t,a,s){var n=this;t.appendChild(a),this.element_.classList.add(this.SEARCHING_CLASS),M.remote.get(e).then(function(e){n.acceptOVCSW(e)&&s.call(n,e.xml,t),n.element_.classList.remove(n.SEARCHING_CLASS)})}},{key:"acceptOVCSW",value:function(e){var t=!0;try{if(200===e.code&&!1===e.error){var a=e.xml.childNodes[0],s=a.getElementsByTagName("control")[0].getElementsByTagName("cuerr")[0],n="0";if(void 0!==s&&(n=s.childNodes[0].nodeValue),"1"===n){var r=a.getElementsByTagName("lerr")[0].getElementsByTagName("err")[0].getElementsByTagName("des")[0].childNodes[0].nodeValue;this.element_.classList.remove(this.SEARCHING_CLASS),t=!1,M.dialog.info(r)}}else t=!1,M.dialog.error("MAPEA: No es posible establecer la conexión con el servidor de Catastro.")}catch(e){t=!1,M.exception("La respuesta no es un JSON válido: ".concat(e,"."))}return t}},{key:"parseCPMRCResults",value:function(e){var t=e.getElementsByTagName("consulta_coordenadas")[0].getElementsByTagName("coordenadas")[0].getElementsByTagName("coord")[0],a=t.getElementsByTagName("pc")[0],s=a.getElementsByTagName("pc1")[0].childNodes[0].nodeValue,n=a.getElementsByTagName("pc2")[0].childNodes[0].nodeValue,r=t.getElementsByTagName("geo")[0],o=r.getElementsByTagName("xcen")[0].childNodes[0].nodeValue,i=r.getElementsByTagName("ycen")[0].childNodes[0].nodeValue,l=r.getElementsByTagName("srs")[0].childNodes[0].nodeValue;return{attributes:[{key:"Referencia Catastral",value:s+n},{key:"Descripción",value:t.getElementsByTagName("ldt")[0].childNodes[0].nodeValue}],rcId:"rc_".concat(s).concat(n),coords:[{xcen:o,ycen:i,srs:l}]}}},{key:"showResults_",value:function(e,t){var a=this;this.getLayer().clear();var s={};t===this.resultsRCContainer_?s=this.parseRCResultsForTemplate_(e,!1):t===this.resultsParamsContainer_&&(s=this.parseParamsResultsForTemplate_(e,!1)),Promise.resolve(s).then(function(e){a.drawResults(e);var s=M.template.compileSync(p.a,{vars:e});t.classList.remove(a.HIDDEN_RESULTS_CLASS);for(var n=t.querySelectorAll(".result"),r=0,o=n.length;r<o;r+=1)n.item(r).removeEventListener("click",a.resultClick_.bind(a));a.zoomToResults();var i=t.querySelector("div.page > div.g-cartografia-flecha-arriba");M.utils.isNullOrEmpty(i)||i.removeEventListener("click",a.resultsClick_.bind(a)),t.innerHTML=s.innerHTML,a.resultsScrollContainer_=t.querySelector("div#m-catastro-results-scroll"),a.resultsScrollContainer_.scrollIntoView(!1);for(var l=0,c=(n=t.getElementsByClassName("result")).length;l<c;l+=1)n.item(l).addEventListener("click",a.resultClick_.bind(a));a.fire(M.evt.COMPLETED)})}},{key:"parseRCResultsForTemplate_",value:function(e,t){var a=this.parseCPMRCResults(e);return!0===t?this.rcResults_.unshift(a):this.rcResults_=[a],{docs:this.rcResults_,total:this.rcResults_.length,partial:!1,notResutls:!1,query:this.inputRC_.value}}},{key:"parseParamsResultsForTemplate_",value:function(e,t){var a,s=this,n=e.getElementsByTagName("consulta_dnp")[0],r="N/A",o="UR",i=n.getElementsByTagName("lrcdnp");if(i.length>0){var l=i[0].getElementsByTagName("rcdnp")[0];a=l.getElementsByTagName("rc")[0];var c=l.getElementsByTagName("dt")[0],u=c.getElementsByTagName("np")[0].childNodes[0].nodeValue,d=c.getElementsByTagName("nm")[0].childNodes[0].nodeValue,m=c.getElementsByTagName("locs")[0].getElementsByTagName("lors")[0].getElementsByTagName("lorus")[0],p=m.getElementsByTagName("npa")[0].childNodes[0].nodeValue,h=m.getElementsByTagName("cpaj")[0].childNodes[0].nodeValue;r="".concat(p," ").concat(h,". ").concat(d," (").concat(u,")")}else{var v=n.getElementsByTagName("bico")[0].getElementsByTagName("bi")[0],f=v.getElementsByTagName("idbi")[0];o=f.getElementsByTagName("cn")[0].childNodes[0].nodeValue,a=f.getElementsByTagName("rc")[0],r=v.getElementsByTagName("ldt")[0].childNodes[0].nodeValue}var g=a.getElementsByTagName("pc1")[0].childNodes[0].nodeValue,y=a.getElementsByTagName("pc2")[0].childNodes[0].nodeValue,_=this.selectProvincias.value+this.selectMunicipios.value+this.inputPoligono.value+this.inputParcela.value,C=M.utils.addParameters(this.CPMRC_url_,{Provincia:"",Municipio:"",SRS:this.facadeMap_.getProjection().code,RC:g+y});return M.remote.get(C).then(function(e){if(s.acceptOVCSW(e)){var a=s.parseCPMRCResults(e.xml),n=a.coords[0].xcen,i=a.coords[0].ycen,l=a.coords[0].srs,c={attributes:[{key:"Referencia Catastral",value:g+y},{key:"Descripción",value:r},{key:"Tipo",value:o}],paramsId:_,rcId:"rc_".concat(g).concat(y),coords:[{xcen:n,ycen:i,srs:l}]};return!0===t?s.paramsResults_.unshift(c):s.paramsResults_=[c],{docs:s.paramsResults_,total:s.paramsResults_.length,partial:!1,notResutls:!1,query:g+y}}return"Unsuccessful response."})}},{key:"resultClick_",value:function(e){e.preventDefault(),M.window.WIDTH,M.config.MOBILE_WIDTH,this.facadeMap_.removePopup();var t=e.currentTarget.id;this.resultClick(t)}},{key:"clearClick_",value:function(){this.element_.classList.remove("shown"),M.utils.isNullOrEmpty(this.inputRC_)||(this.inputRC_.value=""),M.utils.isNullOrEmpty(this.selectProvincias)||(this.selectProvincias.value="0"),M.utils.isNullOrEmpty(this.selectMunicipios)||(this.selectMunicipios.value="0"),M.utils.isNullOrEmpty(this.inputPoligono)||(this.inputPoligono.value=""),M.utils.isNullOrEmpty(this.inputParcela)||(this.inputParcela.value=""),M.utils.isNullOrEmpty(this.resultsRCContainer_)||(this.resultsRCContainer_.innerHTML=""),M.utils.isNullOrEmpty(this.resultsParamsContainer_)||(this.resultsParamsContainer_.innerHTML=""),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||(this.resultsScrollContainer_.innerHTML="",this.resultsScrollContainer_=null),M.utils.isNullOrEmpty(this.rcResults_)?this.rcResults_=[]:this.rcResults_.length=0,M.utils.isNullOrEmpty(this.paramsResults_)?this.paramsResults_=[]:this.paramsResults_.length=0,this.resultsRCContainer_.classList.remove(this.HIDDEN_RESULTS_CLASS),this.resultsParamsContainer_.classList.remove(this.HIDDEN_RESULTS_CLASS),this.clear()}},{key:"resultsClick_",value:function(e){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra-search"),e.target.classlist.toggle("g-cartografia-flecha-arriba"),e.target.classlist.toggle("g-cartografia-flecha-abajo"),this.resultsRCContainer_.classlist.toggle(this.HIDDEN_RESULTS_CLASS),this.resultsParamsContainer_.classlist.toggle(this.HIDDEN_RESULTS_CLASS)}},{key:"onProvinciaSelect",value:function(e){var t=this,a=e.target.value;"0"!==a?M.remote.get(this.ConsultaMunicipioCodigos_,{CodigoProvincia:a,CodigoMunicipio:"",CodigoMunicipioIne:""}).then(function(e){t.loadMunicipiosSelect(e)}):this.clearMunicipiosSelect()}},{key:"clearMunicipiosSelect",value:function(){for(var e=this.element_.getElementsByTagName("select")["m-searchParamsMunicipio-select"];e.firstChild;)e.removeChild(e.firstChild);var t=document.createElement("option");t.value="0",t.innerHTML="Seleccione un municipio",e.appendChild(t)}},{key:"loadMunicipiosSelect",value:function(e){if(200===e.code&&!1===e.error){var t=e.xml.getElementsByTagName("consulta_municipiero")[0].getElementsByTagName("municipiero")[0].getElementsByTagName("muni"),a=this.element_.getElementsByTagName("select")["m-searchParamsMunicipio-select"];this.clearMunicipiosSelect();for(var s=0;s<t.length;s+=1){var n=document.createElement("option"),r=t[s].getElementsByTagName("locat")[0];n.value=r.getElementsByTagName("cmc")[0].childNodes[0].nodeValue,n.innerHTML=t[s].getElementsByTagName("nm")[0].childNodes[0].nodeValue,a.appendChild(n)}}else M.dialog.error("MAPEA: No es posible establecer la conexión con el servidor de Catastro.")}},{key:"drawResults",value:function(e){var t=[];M.utils.isNullOrEmpty(t)&&(t=e.docs);var a=t.map(function(e){var t=e.coords[0].xcen,a=e.coords[0].ycen,s={};return e.attributes.forEach(function(e){s[e.key]=e.value}),new M.Feature(e.rcId,{type:"Feature",geometry:{type:"Point",coordinates:[t,a]},properties:s})},this);this.layer_.addFeatures(a)}},{key:"zoomToResults",value:function(){var e=this.layer_.getFeaturesExtent();this.facadeMap_.removePopup(),this.facadeMap_.setBbox(e)}},{key:"getLayer",value:function(){return this.layer_}},{key:"resultClick",value:function(e){var t=this.layer_.getFeatureById(e);this.selectedFeatures_=[t];var a=t.getGeometry().coordinates;this.unselectResults(),this.selectFeatures([t],a,!0),this.facadeMap_.setCenter(a),this.facadeMap_.setZoom(15)}},{key:"clear",value:function(){this.facadeMap_.removePopup(),this.layer_.clear()}},{key:"selectFeatures",value:function(e,t,a){var s=this;this.unselectResults(),this.selectedFeatures_=e;var n=this.parseFeaturesForTemplate_(e),r=M.template.compileSync(v.a,{jsonp:!1,vars:n,parseToHtml:!1}),o={icon:"g-cartografia-pin",title:this.POPUP_TITLE,content:r},i=this.facadeMap_.getPopup();M.utils.isNullOrEmpty(i)?((i=new M.Popup({panMapIfOutOfView:!a,ani:null})).addTab(o),this.facadeMap_.addPopup(i,[parseFloat(t[0]),parseFloat(t[1])])):i.addTab(o),i.on(M.evt.DESTROY,function(){s.unselectResults(!0)},this)}},{key:"parseFeaturesForTemplate_",value:function(e){var t={features:[]};return e.forEach(function(e){var a=[],s=e.getAttributes();Object.keys(s).forEach(function(e,t){a.push({elem:e,value:s[e]})});var n={attributes:a};t.features.push(n)}),t}},{key:"unselectResults",value:function(e){this.selectedFeatures_.length>0&&(this.selectedFeatures_.length=0,e||this.facadeMap_.removePopup())}},{key:"activate",value:function(){var e=this;if(this.activated)this.deactivate();else{var t=!1;this.facadeMap_.getControls().some(function(a){return!0!==a.activated||a instanceof e||(M.dialog.info("Desactive el control ".concat(a.name," antes de activar este.")),t=!0),t}),!1===t?(this.facadeMap_.on(M.evt.CLICK,this.buildUrl_,this),this.activated=!0,this.element_.querySelector("#m-catastrogetinfo-button").classList.add("activated"),this.element_.querySelector("#m-referencelocatorcatastro-button").classList.remove("activated")):this.activated=!1}}},{key:"deactivate",value:function(){this.facadeMap_.removePopup(),this.facadeMap_.un(M.evt.CLICK,this.buildUrl_,this),this.activated=!1,this.element_.querySelector("#m-catastrogetinfo-button").classList.remove("activated")}},{key:"getActivationButton",value:function(e){return e.querySelector(".m-referencelocatorcatastro button")}},{key:"equals",value:function(e){var a=!1;return e instanceof t&&(a=this.name===e.name),a}},{key:"destroy",value:function(){this.clear(),this.facadeMap_.areasContainer.querySelector(".m-top.m-right").classList.remove("top-extra"),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.layer_=null}}])&&g(a.prototype,s),n&&g(a,n),t}(),P=a(3);function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function E(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var L=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isNullOrEmpty(e)&&M.exception("No ha especificado ningún parámetro."),(a=E(this,N(t).call(this))).map_=null,a.controls_=[],a.catastroLayer_=null;a.RCCOOR_url=null!=e.RCCOOR_url?e.RCCOOR_url:"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCoordenadas.asmx/Consulta_RCCOOR";a.CMC_url=null!=e.CMC_url?e.CMC_url:"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCallejeroCodigos.asmx/ConsultaMunicipioCodigos";a.DNPRC_url=null!=e.DNPRC_url?e.DNPRC_url:"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCallejeroCodigos.asmx/Consulta_DNPRC_Codigos";a.CPMRC_url=null!=e.CPMRC_url?e.CPMRC_url:"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCoordenadas.asmx/Consulta_CPMRC";return a.DNPPP_url=null!=e.DNPPP_url?e.DNPPP_url:"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCallejeroCodigos.asmx/Consulta_DNPPP_Codigos",a.catastroWMS=e.catastroWMS||{},a.metadata_=P.metadata,a}var a,s,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,M.Plugin),a=t,(s=[{key:"addTo",value:function(e){this.config_={RCCOOR_url:this.RCCOOR_url,CMC_url:this.CMC_url,DNPRC_url:this.DNPRC_url,CPMRC_url:this.CPMRC_url,DNPPP_url:this.DNPPP_url,catastroWMS:this.catastroWMS},this.controls_.push(new b(this.config_)),this.map_=e,e.areasContainer.querySelector(".m-top.m-right").classList.add("top-extra"),this.panel_=new M.ui.Panel("panelReferenceLocatorCatastro",{className:"m-catastro",collapsedButtonClass:"g-catastropanel-button-closed",collapsible:!0,position:M.ui.position.TL,tooltip:"Búsqueda catastral"}),this.panel_.on(M.evt.ADDED_TO_MAP,function(e){M.utils.enableTouchScroll(e)}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_),this.config_.catastroWMS.wms_url&&this.config_.catastroWMS.name&&(this.catastroLayer_=new M.layer.WMS({url:this.config_.catastroWMS.wms_url,name:this.config_.catastroWMS.name,legend:"Catastro",transparent:!0,tiled:!1}),this.map_.addWMS(this.catastroLayer_));var t=this;this.controls_[0].on(M.evt.ADDED_TO_MAP,function(){t.fire(M.evt.ADDED_TO_MAP)})}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_);var e=[null,null,null];this.map_=e[0],this.controls_=e[1],this.panel_=e[2]}},{key:"getControls",value:function(){return this.controls_}},{key:"getResultsLayer",value:function(){return this.controls_[0].getLayer()}},{key:"getWMSCatastroLayer",value:function(){return this.catastroLayer_}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"name",get:function(){return"referencelocatorcatastro"}}])&&S(a.prototype,s),n&&S(a,n),t}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.ReferenceLocatorCatastro=L,window.M.control.ReferenceLocatorCatastroControl=b,window.M.impl.control.ReferenceLocatorCatastroControl=c}]);
//# sourceMappingURL=referencelocatorcatastro.ol.min.js.map